from pyspark.sql.types import *
from pyspark.sql import SparkSession

# Create a SparkSession
spark = SparkSession.builder.appName("Import CSV to MySQL").getOrCreate()

# Define the schema for the CSV file

schema1 = StructType([
    StructField("SK_ID_CURR",IntegerType(),True),
    StructField("NAME_CONTRACT_TYPE",StringType(),True),
    StructField("CODE_GENDER",StringType(),True),
    StructField("FLAG_OWN_CAR",StringType(),True),
    StructField("FLAG_OWN_REALTY",StringType(),True),
    StructField("CNT_CHILDREN",IntegerType(),True),
    StructField("AMT_INCOME_TOTAL",IntegerType(),True),
    StructField("AMT_CREDIT",IntegerType(),True),
    StructField("AMT_ANNUITY",IntegerType(),True),
    StructField("AMT_GOODS_PRICE",IntegerType(),True),
    StructField("NAME_TYPE_SUITE",StringType(),True),
    StructField("NAME_INCOME_TYPE",StringType(),True),
    StructField("NAME_EDUCATION_TYPE",StringType(),True),
    StructField("NAME_FAMILY_STATUS",StringType(),True),
    StructField("NAME_HOUSING_TYPE",StringType(),True),
    StructField("REGION_POPULATION_RELATIVE",IntegerType(),True),
    StructField("DAYS_BIRTH",IntegerType(),True),
    StructField("DAYS_EMPLOYED",IntegerType(),True),
    StructField("DAYS_REGISTRATION",IntegerType(),True),
    StructField("DAYS_ID_PUBLISH",IntegerType(),True),
    StructField("OWN_CAR_AGE",StringType(),True),
    StructField("FLAG_MOBIL",IntegerType(),True),
    StructField("FLAG_EMP_PHONE",IntegerType(),True),
    StructField("FLAG_WORK_PHONE",IntegerType(),True),
    StructField("FLAG_CONT_MOBILE",IntegerType(),True),
    StructField("FLAG_PHONE",IntegerType(),True),
    StructField("FLAG_EMAIL",IntegerType(),True),
    StructField("OCCUPATION_TYPE",StringType(),True),
    StructField("CNT_FAM_MEMBERS",IntegerType(),True),
    StructField("REGION_RATING_CLIENT",IntegerType(),True),
    StructField("REGION_RATING_CLIENT_W_CITY",IntegerType(),True),
    StructField("WEEKDAY_APPR_PROCESS_START",StringType(),True),
    StructField("HOUR_APPR_PROCESS_START",IntegerType(),True),
    StructField("REG_REGION_NOT_LIVE_REGION",IntegerType(),True),
    StructField("REG_REGION_NOT_WORK_REGION",IntegerType(),True),
    StructField("LIVE_REGION_NOT_WORK_REGION",IntegerType(),True),
    StructField("REG_CITY_NOT_LIVE_CITY",IntegerType(),True),
    StructField("REG_CITY_NOT_WORK_CITY",IntegerType(),True),
    StructField("LIVE_CITY_NOT_WORK_CITY",IntegerType(),True),
    StructField("ORGANIZATION_TYPE",StringType(),True),
    StructField("EXT_SOURCE_1",IntegerType(),True),
    StructField("EXT_SOURCE_2",IntegerType(),True),
    StructField("EXT_SOURCE_3",IntegerType(),True),
    StructField("APARTMENTS_AVG",IntegerType(),True),
    StructField("BASEMENTAREA_AVG",IntegerType(),True),
    StructField("YEARS_BEGINEXPLUATATION_AVG",IntegerType(),True),
    StructField("YEARS_BUILD_AVG",StringType(),True),
    StructField("COMMONAREA_AVG",StringType(),True),
    StructField("ELEVATORS_AVG",StringType(),True),
    StructField("ENTRANCES_AVG",IntegerType(),True),
    StructField("FLOORSMAX_AVG",IntegerType(),True),
    StructField("FLOORSMIN_AVG",StringType(),True),
    StructField("LANDAREA_AVG",StringType(),True),
    StructField("LIVINGAPARTMENTS_AVG",StringType(),True),
    StructField("LIVINGAREA_AVG",IntegerType(),True),
    StructField("NONLIVINGAPARTMENTS_AVG",StringType(),True),
    StructField("NONLIVINGAREA_AVG",StringType(),True),
    StructField("APARTMENTS_MODE",IntegerType(),True),
    StructField("BASEMENTAREA_MODE",IntegerType(),True),
    StructField("YEARS_BEGINEXPLUATATION_MODE",IntegerType(),True),
    StructField("YEARS_BUILD_MODE",StringType(),True),
    StructField("COMMONAREA_MODE",StringType(),True),
    StructField("ELEVATORS_MODE",StringType(),True),
    StructField("ENTRANCES_MODE",IntegerType(),True),
    StructField("FLOORSMAX_MODE",IntegerType(),True),
    StructField("FLOORSMIN_MODE",StringType(),True),
    StructField("LANDAREA_MODE",StringType(),True),
    StructField("LIVINGAPARTMENTS_MODE",StringType(),True),
    StructField("LIVINGAREA_MODE",IntegerType(),True),
    StructField("NONLIVINGAPARTMENTS_MODE",StringType(),True),
    StructField("NONLIVINGAREA_MODE",StringType(),True),
    StructField("APARTMENTS_MEDI",IntegerType(),True),
    StructField("BASEMENTAREA_MEDI",IntegerType(),True),
    StructField("YEARS_BEGINEXPLUATATION_MEDI",IntegerType(),True),
    StructField("YEARS_BUILD_MEDI",StringType(),True),
    StructField("COMMONAREA_MEDI",StringType(),True),
    StructField("ELEVATORS_MEDI",StringType(),True),
    StructField("ENTRANCES_MEDI",IntegerType(),True),
    StructField("FLOORSMAX_MEDI",IntegerType(),True),
    StructField("FLOORSMIN_MEDI",StringType(),True),
    StructField("LANDAREA_MEDI",StringType(),True),
    StructField("LIVINGAPARTMENTS_MEDI",StringType(),True),
    StructField("LIVINGAREA_MEDI",IntegerType(),True),
    StructField("NONLIVINGAPARTMENTS_MEDI",StringType(),True),
    StructField("NONLIVINGAREA_MEDI",StringType(),True),
    StructField("FONDKAPREMONT_MODE",StringType(),True),
    StructField("HOUSETYPE_MODE",StringType(),True),
    StructField("TOTALAREA_MODE",IntegerType(),True),
    StructField("WALLSMATERIAL_MODE",StringType(),True),
    StructField("EMERGENCYSTATE_MODE",StringType(),True),
    StructField("OBS_30_CNT_SOCIAL_CIRCLE",IntegerType(),True),
    StructField("DEF_30_CNT_SOCIAL_CIRCLE",IntegerType(),True),
    StructField("OBS_60_CNT_SOCIAL_CIRCLE",IntegerType(),True),
    StructField("DEF_60_CNT_SOCIAL_CIRCLE",IntegerType(),True),
    StructField("DAYS_LAST_PHONE_CHANGE",IntegerType(),True),
    StructField("FLAG_DOCUMENT_2",IntegerType(),True),
    StructField("FLAG_DOCUMENT_3",IntegerType(),True),
    StructField("FLAG_DOCUMENT_4",IntegerType(),True),
    StructField("FLAG_DOCUMENT_5",IntegerType(),True),
    StructField("FLAG_DOCUMENT_6",IntegerType(),True),
    StructField("FLAG_DOCUMENT_7",IntegerType(),True),
    StructField("FLAG_DOCUMENT_8",IntegerType(),True),
    StructField("FLAG_DOCUMENT_9",IntegerType(),True),
    StructField("FLAG_DOCUMENT_10",IntegerType(),True),
    StructField("FLAG_DOCUMENT_11",IntegerType(),True),
    StructField("FLAG_DOCUMENT_12",IntegerType(),True),
    StructField("FLAG_DOCUMENT_13",IntegerType(),True),
    StructField("FLAG_DOCUMENT_14",IntegerType(),True),
    StructField("FLAG_DOCUMENT_15",IntegerType(),True),
    StructField("FLAG_DOCUMENT_16",IntegerType(),True),
    StructField("FLAG_DOCUMENT_17",IntegerType(),True),
    StructField("FLAG_DOCUMENT_18",IntegerType(),True),
    StructField("FLAG_DOCUMENT_19",IntegerType(),True),
    StructField("FLAG_DOCUMENT_20",IntegerType(),True),
    StructField("FLAG_DOCUMENT_21",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_HOUR",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_DAY",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_WEEK",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_MON",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_QRT",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_YEAR",IntegerType(),True)
])

schema2 = StructType([
    StructField("SK_ID_CURR",IntegerType(),True),
    StructField("TARGET",IntegerType(),True),
    StructField("NAME_CONTRACT_TYPE",StringType(),True),
    StructField("CODE_GENDER",StringType(),True),
    StructField("FLAG_OWN_CAR",StringType(),True),
    StructField("FLAG_OWN_REALTY",StringType(),True),
    StructField("CNT_CHILDREN",IntegerType(),True),
    StructField("AMT_INCOME_TOTAL",IntegerType(),True),
    StructField("AMT_CREDIT",IntegerType(),True),
    StructField("AMT_ANNUITY",IntegerType(),True),
    StructField("AMT_GOODS_PRICE",IntegerType(),True),
    StructField("NAME_TYPE_SUITE",StringType(),True),
    StructField("NAME_INCOME_TYPE",StringType(),True),
    StructField("NAME_EDUCATION_TYPE",StringType(),True),
    StructField("NAME_FAMILY_STATUS",StringType(),True),
    StructField("NAME_HOUSING_TYPE",StringType(),True),
    StructField("REGION_POPULATION_RELATIVE",IntegerType(),True),
    StructField("DAYS_BIRTH",IntegerType(),True),
    StructField("DAYS_EMPLOYED",IntegerType(),True),
    StructField("DAYS_REGISTRATION",IntegerType(),True),
    StructField("DAYS_ID_PUBLISH",IntegerType(),True),
    StructField("OWN_CAR_AGE",StringType(),True),
    StructField("FLAG_MOBIL",IntegerType(),True),
    StructField("FLAG_EMP_PHONE",IntegerType(),True),
    StructField("FLAG_WORK_PHONE",IntegerType(),True),
    StructField("FLAG_CONT_MOBILE",IntegerType(),True),
    StructField("FLAG_PHONE",IntegerType(),True),
    StructField("FLAG_EMAIL",IntegerType(),True),
    StructField("OCCUPATION_TYPE",StringType(),True),
    StructField("CNT_FAM_MEMBERS",IntegerType(),True),
    StructField("REGION_RATING_CLIENT",IntegerType(),True),
    StructField("REGION_RATING_CLIENT_W_CITY",IntegerType(),True),
    StructField("WEEKDAY_APPR_PROCESS_START",StringType(),True),
    StructField("HOUR_APPR_PROCESS_START",IntegerType(),True),
    StructField("REG_REGION_NOT_LIVE_REGION",IntegerType(),True),
    StructField("REG_REGION_NOT_WORK_REGION",IntegerType(),True),
    StructField("LIVE_REGION_NOT_WORK_REGION",IntegerType(),True),
    StructField("REG_CITY_NOT_LIVE_CITY",IntegerType(),True),
    StructField("REG_CITY_NOT_WORK_CITY",IntegerType(),True),
    StructField("LIVE_CITY_NOT_WORK_CITY",IntegerType(),True),
    StructField("ORGANIZATION_TYPE",StringType(),True),
    StructField("EXT_SOURCE_1",IntegerType(),True),
    StructField("EXT_SOURCE_2",IntegerType(),True),
    StructField("EXT_SOURCE_3",IntegerType(),True),
    StructField("APARTMENTS_AVG",IntegerType(),True),
    StructField("BASEMENTAREA_AVG",IntegerType(),True),
    StructField("YEARS_BEGINEXPLUATATION_AVG",IntegerType(),True),
    StructField("YEARS_BUILD_AVG",IntegerType(),True),
    StructField("COMMONAREA_AVG",IntegerType(),True),
    StructField("ELEVATORS_AVG",IntegerType(),True),
    StructField("ENTRANCES_AVG",IntegerType(),True),
    StructField("FLOORSMAX_AVG",IntegerType(),True),
    StructField("FLOORSMIN_AVG",IntegerType(),True),
    StructField("LANDAREA_AVG",IntegerType(),True),
    StructField("LIVINGAPARTMENTS_AVG",IntegerType(),True),
    StructField("LIVINGAREA_AVG",IntegerType(),True),
    StructField("NONLIVINGAPARTMENTS_AVG",IntegerType(),True),
    StructField("NONLIVINGAREA_AVG",IntegerType(),True),
    StructField("APARTMENTS_MODE",IntegerType(),True),
    StructField("BASEMENTAREA_MODE",IntegerType(),True),
    StructField("YEARS_BEGINEXPLUATATION_MODE",IntegerType(),True),
    StructField("YEARS_BUILD_MODE",IntegerType(),True),
    StructField("COMMONAREA_MODE",IntegerType(),True),
    StructField("ELEVATORS_MODE",IntegerType(),True),
    StructField("ENTRANCES_MODE",IntegerType(),True),
    StructField("FLOORSMAX_MODE",IntegerType(),True),
    StructField("FLOORSMIN_MODE",IntegerType(),True),
    StructField("LANDAREA_MODE",IntegerType(),True),
    StructField("LIVINGAPARTMENTS_MODE",IntegerType(),True),
    StructField("LIVINGAREA_MODE",IntegerType(),True),
    StructField("NONLIVINGAPARTMENTS_MODE",IntegerType(),True),
    StructField("NONLIVINGAREA_MODE",IntegerType(),True),
    StructField("APARTMENTS_MEDI",IntegerType(),True),
    StructField("BASEMENTAREA_MEDI",IntegerType(),True),
    StructField("YEARS_BEGINEXPLUATATION_MEDI",IntegerType(),True),
    StructField("YEARS_BUILD_MEDI",IntegerType(),True),
    StructField("COMMONAREA_MEDI",IntegerType(),True),
    StructField("ELEVATORS_MEDI",IntegerType(),True),
    StructField("ENTRANCES_MEDI",IntegerType(),True),
    StructField("FLOORSMAX_MEDI",IntegerType(),True),
    StructField("FLOORSMIN_MEDI",IntegerType(),True),
    StructField("LANDAREA_MEDI",IntegerType(),True),
    StructField("LIVINGAPARTMENTS_MEDI",IntegerType(),True),
    StructField("LIVINGAREA_MEDI",IntegerType(),True),
    StructField("NONLIVINGAPARTMENTS_MEDI",IntegerType(),True),
    StructField("NONLIVINGAREA_MEDI",IntegerType(),True),
    StructField("FONDKAPREMONT_MODE",StringType(),True),
    StructField("HOUSETYPE_MODE",StringType(),True),
    StructField("TOTALAREA_MODE",IntegerType(),True),
    StructField("WALLSMATERIAL_MODE",StringType(),True),
    StructField("EMERGENCYSTATE_MODE",StringType(),True),
    StructField("OBS_30_CNT_SOCIAL_CIRCLE",IntegerType(),True),
    StructField("DEF_30_CNT_SOCIAL_CIRCLE",IntegerType(),True),
    StructField("OBS_60_CNT_SOCIAL_CIRCLE",IntegerType(),True),
    StructField("DEF_60_CNT_SOCIAL_CIRCLE",IntegerType(),True),
    StructField("DAYS_LAST_PHONE_CHANGE",IntegerType(),True),
    StructField("FLAG_DOCUMENT_2",IntegerType(),True),
    StructField("FLAG_DOCUMENT_3",IntegerType(),True),
    StructField("FLAG_DOCUMENT_4",IntegerType(),True),
    StructField("FLAG_DOCUMENT_5",IntegerType(),True),
    StructField("FLAG_DOCUMENT_6",IntegerType(),True),
    StructField("FLAG_DOCUMENT_7",IntegerType(),True),
    StructField("FLAG_DOCUMENT_8",IntegerType(),True),
    StructField("FLAG_DOCUMENT_9",IntegerType(),True),
    StructField("FLAG_DOCUMENT_10",IntegerType(),True),
    StructField("FLAG_DOCUMENT_11",IntegerType(),True),
    StructField("FLAG_DOCUMENT_12",IntegerType(),True),
    StructField("FLAG_DOCUMENT_13",IntegerType(),True),
    StructField("FLAG_DOCUMENT_14",IntegerType(),True),
    StructField("FLAG_DOCUMENT_15",IntegerType(),True),
    StructField("FLAG_DOCUMENT_16",IntegerType(),True),
    StructField("FLAG_DOCUMENT_17",IntegerType(),True),
    StructField("FLAG_DOCUMENT_18",IntegerType(),True),
    StructField("FLAG_DOCUMENT_19",IntegerType(),True),
    StructField("FLAG_DOCUMENT_20",IntegerType(),True),
    StructField("FLAG_DOCUMENT_21",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_HOUR",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_DAY",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_WEEK",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_MON",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_QRT",IntegerType(),True),
    StructField("AMT_REQ_CREDIT_BUREAU_YEAR",IntegerType(),True),
])

# Read the CSV file
df1 = spark.read.format("csv").option("header", "true").schema(schema1).load("/usr/local/spark/resources/application_test.csv")
df2 = spark.read.format("csv").option("header", "true").schema(schema2).load("/usr/local/spark/resources/application_train.csv")

# Write the data to the MySQL table
df1.write.format("jdbc").options(
    url="jdbc:mysql://mysql:3306/sys",
    driver="com.mysql.cj.jdbc.Driver",
    dbtable="home_credit_default_risk_application_test",
    user="root",
    password="admin"
).mode("append").save()

df2.write.format("jdbc").options(
    url="jdbc:mysql://mysql:3306/sys",
    driver="com.mysql.cj.jdbc.Driver",
    dbtable="home_credit_default_risk_application_train",
    user="root",
    password="admin"
).mode("append").save()